# Story 9.2: Add README.md to Core and Relay

## Status

Done

## Story

**As a** library consumer,
**I want** the `@agent-society/core` and `@agent-society/relay` packages to include a README.md with package description, install instructions, and basic usage examples,
**so that** I can quickly understand each package's purpose and get started using it after installing from npm.

## Acceptance Criteria

1. `packages/core/README.md` exists with: package name, one-line description, install command, and at least one basic usage example showing an import
2. `packages/relay/README.md` exists with: package name, one-line description, install command, and at least one basic usage example showing an import
3. Both READMEs reference the MIT license
4. No changes to any `package.json`, source code, tests, or build configuration
5. `pnpm build` succeeds with no errors across all packages
6. `pnpm test` passes with no regressions

## Tasks / Subtasks

- [x] Task 1: Create `packages/core/README.md` (AC: 1, 3)
  - [x] Add package name as h1 heading: `# @agent-society/core`
  - [x] Add one-line description matching package.json `description` field: "Core library for Nostr-based ILP peer discovery and SPSP"
  - [x] Add Install section with `npm install @agent-society/core`
  - [x] Add Usage section with basic import example showing key exports (e.g., `NostrPeerDiscovery`, `NostrSpspClient`, `NostrSpspServer`, `SocialTrustManager`, `BootstrapService`)
  - [x] Add License section referencing MIT
  - [x] Ensure style is consistent with the existing `packages/bls/README.md` (concise, no unnecessary prose)

- [x] Task 2: Create `packages/relay/README.md` (AC: 2, 3)
  - [x] Add package name as h1 heading: `# @agent-society/relay`
  - [x] Add one-line description matching package.json `description` field: "ILP-gated Nostr relay with Business Logic Server"
  - [x] Add Install section with `npm install @agent-society/relay`
  - [x] Add Usage section with basic import example showing key exports (e.g., `NostrRelayServer`, `BusinessLogicServer`, `PricingService`, `SqliteEventStore`)
  - [x] Add License section referencing MIT
  - [x] Ensure style is consistent with the existing `packages/bls/README.md`

- [x] Task 3: Verify no other files were changed (AC: 4)
  - [x] Confirm no package.json files were modified
  - [x] Confirm no source files were modified
  - [x] Confirm no test files were modified

- [x] Task 4: Run build and test validation (AC: 5, 6)
  - [x] Run `pnpm build` — all packages build successfully
  - [x] Run `pnpm test` — all tests pass with no regressions

## Dev Notes

### Previous Story Insights
[Source: docs/stories/9.1.story.md — Dev Agent Record]

Story 9.1 (Add Publish Metadata) is the most recent completed story. Key insights:
- All changes were JSON-only (package.json metadata). No code changes.
- `pnpm test`: 1020 passed, 2 failed — both failures are **pre-existing** (`SocialPeerDiscovery.test.ts` and `RelayMonitor.test.ts` have `subscribeMany` call signature assertion mismatches unrelated to this epic)
- `packages/ui-prototypes` build failure is pre-existing (unused variable TS errors) and unrelated to this epic
- These pre-existing failures should be expected again in this story's validation.

### Existing README Reference
[Source: packages/bls/README.md]

The `@agent-society/bls` package already has a comprehensive README (~223 lines covering Docker, Kubernetes, env vars, and endpoints). The READMEs for `core` and `relay` should be **much simpler** (target ~15-20 lines) — the epic description says "Minimal README with package description, install, basic usage example." The BLS README is extensive because it's a deployable Docker service; `core` and `relay` are libraries, so a simpler format is appropriate.

Recommended structure for both new READMEs (use `npm install` not `pnpm add` — these are public packages targeting external consumers):
```
# @agent-society/<package>

<one-line description>

## Install

npm install @agent-society/<package>

## Usage

<basic import example>

## License

MIT
```

### Package Descriptions
[Source: packages/core/package.json, packages/relay/package.json]

- **core:** `"description": "Core library for Nostr-based ILP peer discovery and SPSP"`
- **relay:** `"description": "ILP-gated Nostr relay with Business Logic Server"`

### Key Exports for Usage Examples

**@agent-society/core** key exports:
[Source: packages/core/src/index.ts]
- `NostrPeerDiscovery` — Discover ILP peers from Nostr follow lists
- `NostrSpspClient` — Query and request SPSP parameters from peers
- `NostrSpspServer` — Publish SPSP info and handle incoming requests
- `SocialTrustManager` — Compute trust scores from social graph
- `BootstrapService` — Orchestrate full peer discovery + SPSP + connector wiring
- Event constants: `ILP_PEER_INFO_KIND`, `SPSP_REQUEST_KIND`, `SPSP_RESPONSE_KIND`
- Event builders: `buildIlpPeerInfoEvent`, `buildSpspRequestEvent`, `buildSpspResponseEvent`
- Event parsers: `parseIlpPeerInfo`, `parseSpspRequest`, `parseSpspResponse`
- Error classes: `AgentSocietyError`, `PeerDiscoveryError`, `SpspError`, etc.

**@agent-society/relay** key exports:
[Source: packages/relay/src/index.ts]
- `NostrRelayServer` — WebSocket server handling NIP-01 relay protocol
- `ConnectionHandler` — Individual WebSocket connection management
- `BusinessLogicServer` — BLS HTTP server for ILP payment verification
- `PricingService` — Configurable per-event pricing
- `SqliteEventStore` / `InMemoryEventStore` — Event storage backends
- `encodeEventToToon` / `decodeEventFromToon` — TOON encoding/decoding
- `matchFilter` — NIP-01 filter matching
- Re-exports from `@agent-society/bls`: `createBlsServer`

### Component Descriptions
[Source: docs/architecture/5-components.md]

**@agent-society/core:**
Main protocol library providing peer discovery, SPSP exchange, and trust calculation.
Dependencies: nostr-tools
Technology Stack: TypeScript, nostr-tools

**@agent-society/relay:**
Reference implementation of ILP-gated Nostr relay with pay-to-write.
Dependencies: @agent-society/core, better-sqlite3, ws, Hono
Technology Stack: TypeScript, SQLite, WebSocket

### File Locations

Files to create:
- `packages/core/README.md` — New file
- `packages/relay/README.md` — New file

Files NOT modified:
- `packages/bls/README.md` — Already exists, not part of this story
- All `package.json` files — No changes
- All source files (`src/**`) — No code changes
- All test files — No test changes

### npm `files` Field and README
[Source: packages/core/package.json, packages/relay/package.json]

Both packages have `"files": ["dist"]`. However, npm **always** includes `README.md` (and `LICENSE`) in published packages regardless of the `files` field. No `package.json` changes are needed to include the README in the tarball.

### Project Structure Notes
[Source: docs/architecture/9-source-tree.md]

The source tree shows `packages/core/` and `packages/relay/` directories. README.md files should be placed at the package root level (same level as `package.json` and `tsconfig.json`), which is the standard npm convention.

No structural conflicts identified.

### Technical Constraints

- **Markdown-only changes:** This story only creates two `.md` files. No TypeScript or JSON changes.
- **No version bump:** Version stays at `0.1.0`. Story 9.3 handles the bump to `1.0.0`.
- **Minimal content:** The epic explicitly says "Minimal README" — avoid over-documenting. Keep it concise.
- **Consistent style:** Follow the general structure pattern from `packages/bls/README.md` but much shorter (no Docker/Kubernetes/ENV sections — those are BLS-specific).

### Testing
[Source: docs/architecture/13-test-strategy-and-standards.md]

- **Test framework:** Vitest 1.x
- **No new tests required for this story** — README files don't require unit tests
- **Validation:** Run `pnpm build` and `pnpm test` to confirm no regressions
- **Expected results:** ~1020 tests pass, 2 pre-existing failures (same as Story 9.1)

## Dev Agent Record

### Agent Model Used
Claude Opus 4.6

### File List
| File | Action |
|------|--------|
| `packages/core/README.md` | Created |
| `packages/relay/README.md` | Created |

### Completion Notes
- Both READMEs follow the concise structure recommended in Dev Notes (~20 lines each)
- `pnpm build` passes for all packages (ui-prototypes failure is pre-existing, unrelated)
- `pnpm test`: 1020 passed, 2 failed — both failures are pre-existing (`SocialPeerDiscovery.test.ts` and `RelayMonitor.test.ts` `subscribeMany` assertion mismatches), same as Story 9.1
- No package.json, source, or test files were modified

### Debug Log References
None — no issues encountered.

## QA Results

### Review Date: 2026-02-11

### Reviewed By: Quinn (Test Architect)

### Code Quality Assessment

Excellent implementation. Both READMEs are concise (~25 lines each), match the recommended structure from the Dev Notes, and accurately reference real exports verified against source. The documentation-only scope is clean — no source, test, or config files were touched by this story.

### Refactoring Performed

None required. The deliverables are two small markdown files with no code to refactor.

### Compliance Check

- Coding Standards: ✓ Not applicable — no code changes
- Project Structure: ✓ README files placed at package root per npm convention and source tree spec
- Testing Strategy: ✓ No tests required for markdown-only story; existing test suite unaffected (1020 passed, 2 pre-existing failures)
- All ACs Met: ✓ All 6 acceptance criteria verified (see below)

**AC Verification:**

| AC | Requirement | Status | Evidence |
|----|-------------|--------|----------|
| 1 | `packages/core/README.md` with name, description, install, usage | ✓ | H1 matches package name, description matches package.json, `npm install` command present, import example with 5 real exports |
| 2 | `packages/relay/README.md` with name, description, install, usage | ✓ | H1 matches package name, description matches package.json, `npm install` command present, import example with 4 real exports |
| 3 | Both READMEs reference MIT license | ✓ | Both end with `## License\n\nMIT` |
| 4 | No changes to package.json, source, tests, or build config | ✓ | `git diff --name-only HEAD` shows only pre-existing Story 9.1 changes; README files are untracked new additions |
| 5 | `pnpm build` succeeds with no errors | ✓ | core, relay, bls all build successfully; ui-prototypes failure is pre-existing (TS6133) |
| 6 | `pnpm test` passes with no regressions | ✓ | 1020 passed, 2 failed — same pre-existing failures as Story 9.1 |

### Improvements Checklist

All items pass. No improvements needed.

- [x] Verified all named exports in core README exist in `packages/core/src/index.ts`
- [x] Verified all named exports in relay README exist in `packages/relay/src/index.ts`
- [x] Verified descriptions match `package.json` `description` fields exactly
- [x] Verified concise style (~25 lines) consistent with story requirement for "minimal README"
- [x] Confirmed consistent structure between both READMEs
- [x] Confirmed `npm install` (not `pnpm add`) used for external consumer audience

### Security Review

No security concerns. Documentation-only changes with no executable code, no secrets, and no configuration modifications.

### Performance Considerations

No performance impact. README files are not loaded at runtime and do not affect build or test performance.

### Files Modified During Review

None. No changes were needed.

### Gate Status

Gate: PASS → docs/qa/gates/9.2-add-readme-to-core-and-relay.yml
Risk profile: Low — documentation-only story with no code changes
NFR assessment: All PASS — no functional impact

### Recommended Status

✓ Ready for Done

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-02-11 | 0.1 | Initial story draft | SM (Claude Opus 4.6) |
| 2026-02-11 | 0.2 | Validation fixes: added NostrSpspServer to core usage examples, clarified npm install intent for external consumers | SM (Claude Opus 4.6) |
| 2026-02-11 | 0.3 | Validation fixes: added SqliteEventStore to relay task usage examples, added BLS README size note (~223 lines) to reinforce brevity target | SM (Claude Opus 4.6) |
