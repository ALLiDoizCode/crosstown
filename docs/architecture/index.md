# Crosstown Protocol Architecture Document

## Table of Contents

- [Crosstown Protocol Architecture Document](#table-of-contents)
  - [1. Introduction](./1-introduction.md)
    - [1.1 Starter Template or Existing Project](./1-introduction.md#11-starter-template-or-existing-project)
    - [1.2 Change Log](./1-introduction.md#12-change-log)
  - [2. High Level Architecture](./2-high-level-architecture.md)
    - [2.1 Technical Summary](./2-high-level-architecture.md#21-technical-summary)
    - [2.2 High Level Overview](./2-high-level-architecture.md#22-high-level-overview)
    - [2.3 High Level Project Diagram](./2-high-level-architecture.md#23-high-level-project-diagram)
    - [2.4 Architectural and Design Patterns](./2-high-level-architecture.md#24-architectural-and-design-patterns)
  - [3. Tech Stack](./3-tech-stack.md)
    - [3.1 Cloud Infrastructure](./3-tech-stack.md#31-cloud-infrastructure)
    - [3.2 Technology Stack Table](./3-tech-stack.md#32-technology-stack-table)
  - [4. Data Models](./4-data-models.md)
    - [4.1 IlpPeerInfo](./4-data-models.md#41-ilppeerinfo)
    - [4.2 SpspInfo](./4-data-models.md#42-spspinfo)
    - [4.3 SpspRequest](./4-data-models.md#43-spsprequest)
    - [4.4 SpspResponse](./4-data-models.md#44-spspresponse)
    - [4.5 HandlePacketRequest / HandlePacketResponse](./4-data-models.md#45-handlepacketrequest--handlepacketresponse)
    - [4.6 Bootstrap Types](./4-data-models.md#46-bootstrap-types)
    - [4.7 Client Interfaces](./4-data-models.md#47-client-interfaces)
    - [4.8 Settlement Types](./4-data-models.md#48-settlement-types)
    - [4.9 NostrEvent (External)](./4-data-models.md#49-nostrevent-external)
  - [5. Components](./5-components.md)
    - [5.1 @crosstown/core](./5-components.md#51-crosstowncore)
    - [5.2 @crosstown/bls](./5-components.md#52-crosstownbls)
    - [5.3 @crosstown/relay](./5-components.md#53-crosstownrelay)
    - [5.4 @crosstown/examples](./5-components.md#54-crosstownexamples)
    - [5.5 docker/](./5-components.md#55-docker)
    - [5.6 packages/agent/ (Planned)](./5-components.md#56-packagesagent-planned----epic-11)
    - [5.7 Component Diagram](./5-components.md#57-component-diagram)
  - [6. External APIs](./6-external-apis.md)
    - [6.1 Nostr Relays](./6-external-apis.md#61-nostr-relays)
    - [6.2 agent-runtime Connector](./6-external-apis.md#62-agent-runtime-connector)
    - [6.3 ArDrive Peer Registry](./6-external-apis.md#63-ardrive-peer-registry)
  - [7. Core Workflows](./7-core-workflows.md)
    - [7.1 Layered Peer Discovery Flow](./7-core-workflows.md#71-layered-peer-discovery-flow)
    - [7.2 SPSP Handshake with Settlement Negotiation](./7-core-workflows.md#72-spsp-handshake-with-settlement-negotiation)
    - [7.3 ILP-Gated Relay Write Flow](./7-core-workflows.md#73-ilp-gated-relay-write-flow)
    - [7.4 Network Bootstrap Flow](./7-core-workflows.md#74-network-bootstrap-flow)
    - [7.5 Embedded Connector Composition](./7-core-workflows.md#75-embedded-connector-composition)
    - [7.6 Cross-Town DVM Work Dispatch (Planned)](./7-core-workflows.md#76-cross-town-dvm-work-dispatch-planned----epics-12-13)
    - [7.7 Cross-Town NIP-34 Patch Merge (Planned)](./7-core-workflows.md#77-cross-town-nip-34-patch-merge-planned----epic-15)
  - [8. Database Schema](./8-database-schema.md)
  - [9. Source Tree](./9-source-tree.md)
  - [10. Infrastructure and Deployment](./10-infrastructure-and-deployment.md)
    - [10.1 Infrastructure as Code](./10-infrastructure-and-deployment.md#101-infrastructure-as-code)
    - [10.2 Deployment Strategy](./10-infrastructure-and-deployment.md#102-deployment-strategy)
    - [10.3 Environments](./10-infrastructure-and-deployment.md#103-environments)
    - [10.4 Environment Promotion Flow](./10-infrastructure-and-deployment.md#104-environment-promotion-flow)
    - [10.5 Rollback Strategy](./10-infrastructure-and-deployment.md#105-rollback-strategy)
  - [11. Error Handling Strategy](./11-error-handling-strategy.md)
    - [11.1 General Approach](./11-error-handling-strategy.md#111-general-approach)
    - [11.2 Logging Standards](./11-error-handling-strategy.md#112-logging-standards)
    - [11.3 Error Handling Patterns](./11-error-handling-strategy.md#113-error-handling-patterns)
      - [External API Errors (Nostr Relays)](./11-error-handling-strategy.md#external-api-errors-nostr-relays)
      - [Business Logic Errors](./11-error-handling-strategy.md#business-logic-errors)
      - [Bootstrap Errors](./11-error-handling-strategy.md#bootstrap-errors)
      - [Data Consistency](./11-error-handling-strategy.md#data-consistency)
  - [12. Coding Standards](./12-coding-standards.md)
    - [12.1 Core Standards](./12-coding-standards.md#121-core-standards)
    - [12.2 Naming Conventions](./12-coding-standards.md#122-naming-conventions)
    - [12.3 Critical Rules](./12-coding-standards.md#123-critical-rules)
  - [13. Test Strategy and Standards](./13-test-strategy-and-standards.md)
    - [13.1 Testing Philosophy](./13-test-strategy-and-standards.md#131-testing-philosophy)
    - [13.2 Test Types and Organization](./13-test-strategy-and-standards.md#132-test-types-and-organization)
      - [Unit Tests](./13-test-strategy-and-standards.md#unit-tests)
      - [Integration Tests](./13-test-strategy-and-standards.md#integration-tests)
      - [E2E Tests](./13-test-strategy-and-standards.md#e2e-tests)
    - [13.3 Test Data Management](./13-test-strategy-and-standards.md#133-test-data-management)
    - [13.4 Continuous Testing](./13-test-strategy-and-standards.md#134-continuous-testing)
  - [14. Security](./14-security.md)
    - [14.1 Input Validation](./14-security.md#141-input-validation)
    - [14.2 Authentication & Authorization](./14-security.md#142-authentication--authorization)
    - [14.3 Secrets Management](./14-security.md#143-secrets-management)
    - [14.4 API Security](./14-security.md#144-api-security)
    - [14.5 Data Protection](./14-security.md#145-data-protection)
    - [14.6 NIP Handler Security (Planned)](./14-security.md#146-nip-handler-security-planned----epic-11)
    - [14.7 Peering Gate Security (Planned)](./14-security.md#147-peering-gate-security-planned----epics-12-17)
    - [14.8 NIP-46 Remote Signing (Planned)](./14-security.md#148-nip-46-remote-signing-planned----epic-12)
    - [14.9 Dependency Security](./14-security.md#149-dependency-security)
    - [14.10 Security Testing](./14-security.md#1410-security-testing)
  - [15. NIP Adoption Roadmap](./15-nip-adoption-roadmap.md)
    - [Phase 1: Cross-Town Communication Foundation (Epic 12)](./15-nip-adoption-roadmap.md#phase-1-cross-town-communication-foundation-epic-12)
    - [Phase 2: Paid Computation Marketplace (Epic 13)](./15-nip-adoption-roadmap.md#phase-2-paid-computation-marketplace-epic-13)
    - [Phase 3: Trust Infrastructure & Reputation (Epic 14)](./15-nip-adoption-roadmap.md#phase-3-trust-infrastructure--reputation-epic-14)
    - [Phase 4: Decentralized Git Collaboration (Epic 15)](./15-nip-adoption-roadmap.md#phase-4-decentralized-git-collaboration-epic-15)
    - [Phase 5: Content & Community Layer (Epic 16)](./15-nip-adoption-roadmap.md#phase-5-content--community-layer-epic-16)
    - [Phase 6: Cross-Town Federation & Agent Swarms (Epic 17)](./15-nip-adoption-roadmap.md#phase-6-cross-town-federation--agent-swarms-epic-17)
    - [Trust Score Evolution](./15-nip-adoption-roadmap.md#trust-score-evolution)
    - [NIP Allocation Summary](./15-nip-adoption-roadmap.md#nip-allocation-summary)
  - [16. Checklist Results Report](./16-checklist-results-report.md)
  - [17. Next Steps](./17-next-steps.md)
    - [17.1 Current State](./17-next-steps.md#171-current-state)
    - [17.2 Immediate Actions](./17-next-steps.md#172-immediate-actions)
    - [17.3 Architecture Document Maintenance](./17-next-steps.md#173-architecture-document-maintenance)
